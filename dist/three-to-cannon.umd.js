!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("cannon-es"),require("three/examples/jsm/math/ConvexHull.js"),require("three")):"function"==typeof define&&define.amd?define(["exports","cannon-es","three/examples/jsm/math/ConvexHull.js","three"],r):r((e=e||self).threeToCannon={},e.cannonEs,e.ConvexHull_js,e.THREE)}(this,function(e,r,t,n){var o=Math.PI/2,a={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},i=function(e,i){var y;if((i=i||{}).type===a.BOX)return m(e);if(i.type===a.CYLINDER)return function(e,t){var a=["x","y","z"],i=t.cylinderAxis||"y",u=a.splice(a.indexOf(i),1)&&a,m=(new n.Box3).setFromObject(e);if(!isFinite(m.min.lengthSq()))return null;var s=m.max[i]-m.min[i],l=.5*Math.max(m.max[u[0]]-m.min[u[0]],m.max[u[1]]-m.min[u[1]]),y=new r.Cylinder(l,l,s,12);return y._type=r.Shape.types.CYLINDER,y.radiusTop=l,y.radiusBottom=l,y.height=s,y.numSegments=12,y.orientation=new r.Quaternion,y.orientation.setFromEuler("y"===i?o:0,"z"===i?o:0,0,"XYZ").normalize(),y}(e,i);if(i.type===a.SPHERE)return function(e,t){if(t.sphereRadius)return new r.Sphere(t.sphereRadius);var n=s(e);return n?(n.computeBoundingSphere(),new r.Sphere(n.boundingSphere.radius)):null}(e,i);if(i.type===a.HULL)return function(e){var o=s(e);if(!o||!o.vertices.length)return null;for(var a=0;a<o.vertices.length;a++)o.vertices[a].x+=1e-4*(Math.random()-.5),o.vertices[a].y+=1e-4*(Math.random()-.5),o.vertices[a].z+=1e-4*(Math.random()-.5);var i=(new t.ConvexHull).setFromObject(new n.Mesh(o)).faces,u=[],m=[];for(a=0;a<i.length;a++){var l=i[a],y=l.edge;do{var f=y.head().point;u.push(new r.Vec3(f.x,f.y,f.z)),m.push(new r.Vec3(l.normal.x,l.normal.y,l.normal.z)),y=y.next}while(y!==l.edge)}return new r.ConvexPolyhedron({vertices:u,normals:m})}(e);if(i.type===a.MESH)return(y=s(e))?function(e){var t=l(e);if(!t.length)return null;var n=Object.keys(t).map(Number);return new r.Trimesh(t,n)}(y):null;if(i.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',i.type);if(!(y=s(e)))return null;switch(y.metadata?y.metadata.type:y.type){case"BoxGeometry":case"BoxBufferGeometry":return u(y);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var t=e.metadata?e.metadata.parameters:e.parameters,o=new r.Cylinder(t.radiusTop,t.radiusBottom,t.height,t.radialSegments);return o._type=r.Shape.types.CYLINDER,o.radiusTop=t.radiusTop,o.radiusBottom=t.radiusBottom,o.height=t.height,o.numSegments=t.radialSegments,o.orientation=new r.Quaternion,o.orientation.setFromEuler(n.Math.degToRad(90),0,0,"XYZ").normalize(),o}(y);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var t=e.boundingBox;return new r.Box(new r.Vec3((t.max.x-t.min.x)/2||.1,(t.max.y-t.min.y)/2||.1,(t.max.z-t.min.z)/2||.1))}(y);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return new r.Sphere((e.metadata?e.metadata.parameters:e.parameters).radius)}(y);case"TubeGeometry":case"Geometry":case"BufferGeometry":return m(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',y.type),u(y)}};function u(e){if(!l(e).length)return null;e.computeBoundingBox();var t=e.boundingBox;return new r.Box(new r.Vec3((t.max.x-t.min.x)/2,(t.max.y-t.min.y)/2,(t.max.z-t.min.z)/2))}function m(e){var t=e.clone();t.quaternion.set(0,0,0,1),t.updateMatrixWorld();var o=(new n.Box3).setFromObject(t);if(!isFinite(o.min.lengthSq()))return null;var a=new r.Box(new r.Vec3((o.max.x-o.min.x)/2,(o.max.y-o.min.y)/2,(o.max.z-o.min.z)/2)),i=o.translate(t.position.negate()).getCenter(new n.Vector3);return i.lengthSq()&&(a.offset=i),a}function s(e){var r,t=function(e){var r=[];return e.traverse(function(e){"Mesh"===e.type&&r.push(e)}),r}(e),o=new n.Geometry,a=new n.Geometry;if(0===t.length)return null;if(1===t.length){var i=new n.Vector3,u=new n.Quaternion,m=new n.Vector3;return t[0].geometry.isBufferGeometry?t[0].geometry.attributes.position&&t[0].geometry.attributes.position.itemSize>2&&o.fromBufferGeometry(t[0].geometry):o=t[0].geometry.clone(),o.metadata=t[0].geometry.metadata,t[0].updateMatrixWorld(),t[0].matrixWorld.decompose(i,u,m),o.scale(m.x,m.y,m.z)}for(;r=t.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&&r.geometry.attributes.position.itemSize>2){var s=new n.Geometry;s.fromBufferGeometry(r.geometry),a.merge(s,r.matrixWorld),s.dispose()}}else a.merge(r.geometry,r.matrixWorld);var l=new n.Matrix4;return l.scale(e.scale),a.applyMatrix(l),a}function l(e){return e.attributes||(e=(new n.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}i.Type=a,e.threeToCannon=i});
//# sourceMappingURL=three-to-cannon.umd.js.map
