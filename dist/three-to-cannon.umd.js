!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cannon-es"),require("three/examples/jsm/math/ConvexHull.js"),require("three")):"function"==typeof define&&define.amd?define(["exports","cannon-es","three/examples/jsm/math/ConvexHull.js","three"],t):t((e=e||self).threeToCannon={},e.cannonEs,e.ConvexHull_js,e.THREE)}(this,function(e,t,r,n){var o=Math.PI/2,a={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},i=function(e,i){var y;if((i=i||{}).type===a.BOX)return u(e);if(i.type===a.CYLINDER)return function(e,r){var a,i,m,u=new n.Box3,s=["x","y","z"],l=r.cylinderAxis||"y",y=s.splice(s.indexOf(l),1)&&s;return u.setFromObject(e),isFinite(u.min.lengthSq())?(i=u.max[l]-u.min[l],m=.5*Math.max(u.max[y[0]]-u.min[y[0]],u.max[y[1]]-u.min[y[1]]),(a=new t.Cylinder(m,m,i,12))._type=t.Shape.types.CYLINDER,a.radiusTop=m,a.radiusBottom=m,a.height=i,a.numSegments=12,a.orientation=new t.Quaternion,a.orientation.setFromEuler("y"===l?o:0,"z"===l?o:0,0,"XYZ").normalize(),a):null}(e,i);if(i.type===a.SPHERE)return function(e,r){if(r.sphereRadius)return new t.Sphere(r.sphereRadius);var n=s(e);return n?(n.computeBoundingSphere(),new t.Sphere(n.boundingSphere.radius)):null}(e,i);if(i.type===a.HULL)return function(e){var o,a,i,m,u=s(e);if(!u||!u.vertices.length)return null;for(o=0;o<u.vertices.length;o++)u.vertices[o].x+=1e-4*(Math.random()-.5),u.vertices[o].y+=1e-4*(Math.random()-.5),u.vertices[o].z+=1e-4*(Math.random()-.5);for(m=(new r.ConvexHull).setFromObject(new n.Mesh(u)),a=new Array(m.vertices.length),o=0;o<m.vertices.length;o++)a[o]=new t.Vec3(m.vertices[o].x,m.vertices[o].y,m.vertices[o].z);for(i=new Array(m.faces.length),o=0;o<m.faces.length;o++)i[o]=[m.faces[o].a,m.faces[o].b,m.faces[o].c];return new t.ConvexPolyhedron(a,i)}(e);if(i.type===a.MESH)return(y=s(e))?function(e){var r,n=l(e);return n.length?(r=Object.keys(n).map(Number),new t.Trimesh(n,r)):null}(y):null;if(i.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',i.type);if(!(y=s(e)))return null;switch(y.metadata?y.metadata.type:y.type){case"BoxGeometry":case"BoxBufferGeometry":return m(y);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var r,o=e.metadata?e.metadata.parameters:e.parameters;return(r=new t.Cylinder(o.radiusTop,o.radiusBottom,o.height,o.radialSegments))._type=t.Shape.types.CYLINDER,r.radiusTop=o.radiusTop,r.radiusBottom=o.radiusBottom,r.height=o.height,r.numSegments=o.radialSegments,r.orientation=new t.Quaternion,r.orientation.setFromEuler(n.Math.degToRad(90),0,0,"XYZ").normalize(),r}(y);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var r=e.boundingBox;return new t.Box(new t.Vec3((r.max.x-r.min.x)/2||.1,(r.max.y-r.min.y)/2||.1,(r.max.z-r.min.z)/2||.1))}(y);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return new t.Sphere((e.metadata?e.metadata.parameters:e.parameters).radius)}(y);case"TubeGeometry":case"Geometry":case"BufferGeometry":return u(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',y.type),m(y)}};function m(e){if(!l(e).length)return null;e.computeBoundingBox();var r=e.boundingBox;return new t.Box(new t.Vec3((r.max.x-r.min.x)/2,(r.max.y-r.min.y)/2,(r.max.z-r.min.z)/2))}function u(e){var r,o,a=new n.Box3,i=e.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),a.setFromObject(i),isFinite(a.min.lengthSq())?(r=new t.Box(new t.Vec3((a.max.x-a.min.x)/2,(a.max.y-a.min.y)/2,(a.max.z-a.min.z)/2)),(o=a.translate(i.position.negate()).getCenter(new n.Vector3)).lengthSq()&&(r.offset=o),r):null}function s(e){var t,r,o=function(e){var t=[];return e.traverse(function(e){"Mesh"===e.type&&t.push(e)}),t}(e),a=new n.Geometry,i=new n.Geometry;if(0===o.length)return null;if(1===o.length){var m=new n.Vector3,u=new n.Quaternion,s=new n.Vector3;return o[0].geometry.isBufferGeometry?o[0].geometry.attributes.position&&o[0].geometry.attributes.position.itemSize>2&&a.fromBufferGeometry(o[0].geometry):a=o[0].geometry.clone(),a.metadata=o[0].geometry.metadata,o[0].updateMatrixWorld(),o[0].matrixWorld.decompose(m,u,s),a.scale(s.x,s.y,s.z)}for(;r=o.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&&r.geometry.attributes.position.itemSize>2){var l=new n.Geometry;l.fromBufferGeometry(r.geometry),i.merge(l,r.matrixWorld),l.dispose()}}else i.merge(r.geometry,r.matrixWorld);return(t=new n.Matrix4).scale(e.scale),i.applyMatrix(t),i}function l(e){return e.attributes||(e=(new n.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}i.Type=a,e.threeToCannon=i});
//# sourceMappingURL=three-to-cannon.umd.js.map
