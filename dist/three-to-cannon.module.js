import{Sphere as e,Box as t,Vec3 as r,ConvexPolyhedron as n,Cylinder as a,Shape as o,Quaternion as i,Trimesh as m}from"cannon-es";import{ConvexHull as u}from"three/examples/jsm/math/ConvexHull.js";import{Box3 as s,Vector3 as y,Mesh as f,Math as l,Geometry as c,Quaternion as p,Matrix4 as d,BufferGeometry as g}from"three";var h=Math.PI/2,x={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},w=function(y,c){var p;if((c=c||{}).type===x.BOX)return B(y);if(c.type===x.CYLINDER)return function(e,t){var r,n,m,u=new s,y=["x","y","z"],f=t.cylinderAxis||"y",l=y.splice(y.indexOf(f),1)&&y;return u.setFromObject(e),isFinite(u.min.lengthSq())?(n=u.max[f]-u.min[f],m=.5*Math.max(u.max[l[0]]-u.min[l[0]],u.max[l[1]]-u.min[l[1]]),(r=new a(m,m,n,12))._type=o.types.CYLINDER,r.radiusTop=m,r.radiusBottom=m,r.height=n,r.numSegments=12,r.orientation=new i,r.orientation.setFromEuler("y"===f?h:0,"z"===f?h:0,0,"XYZ").normalize(),r):null}(y,c);if(c.type===x.SPHERE)return function(t,r){if(r.sphereRadius)return new e(r.sphereRadius);var n=b(t);return n?(n.computeBoundingSphere(),new e(n.boundingSphere.radius)):null}(y,c);if(c.type===x.HULL)return function(e){var t,a,o,i,m=b(e);if(!m||!m.vertices.length)return null;for(t=0;t<m.vertices.length;t++)m.vertices[t].x+=1e-4*(Math.random()-.5),m.vertices[t].y+=1e-4*(Math.random()-.5),m.vertices[t].z+=1e-4*(Math.random()-.5);for(i=(new u).setFromObject(new f(m)),a=new Array(i.vertices.length),t=0;t<i.vertices.length;t++)a[t]=new r(i.vertices[t].x,i.vertices[t].y,i.vertices[t].z);for(o=new Array(i.faces.length),t=0;t<i.faces.length;t++)o[t]=[i.faces[t].a,i.faces[t].b,i.faces[t].c];return new n(a,o)}(y);if(c.type===x.MESH)return(p=b(y))?function(e){var t,r=S(e);return r.length?(t=Object.keys(r).map(Number),new m(r,t)):null}(p):null;if(c.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',c.type);if(!(p=b(y)))return null;switch(p.metadata?p.metadata.type:p.type){case"BoxGeometry":case"BoxBufferGeometry":return v(p);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var t,r=e.metadata?e.metadata.parameters:e.parameters;return(t=new a(r.radiusTop,r.radiusBottom,r.height,r.radialSegments))._type=o.types.CYLINDER,t.radiusTop=r.radiusTop,t.radiusBottom=r.radiusBottom,t.height=r.height,t.numSegments=r.radialSegments,t.orientation=new i,t.orientation.setFromEuler(l.degToRad(90),0,0,"XYZ").normalize(),t}(p);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var n=e.boundingBox;return new t(new r((n.max.x-n.min.x)/2||.1,(n.max.y-n.min.y)/2||.1,(n.max.z-n.min.z)/2||.1))}(p);case"SphereGeometry":case"SphereBufferGeometry":return function(t){return new e((t.metadata?t.metadata.parameters:t.parameters).radius)}(p);case"TubeGeometry":case"Geometry":case"BufferGeometry":return B(y);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',p.type),v(p)}};function v(e){if(!S(e).length)return null;e.computeBoundingBox();var n=e.boundingBox;return new t(new r((n.max.x-n.min.x)/2,(n.max.y-n.min.y)/2,(n.max.z-n.min.z)/2))}function B(e){var n,a,o=new s,i=e.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),o.setFromObject(i),isFinite(o.min.lengthSq())?(n=new t(new r((o.max.x-o.min.x)/2,(o.max.y-o.min.y)/2,(o.max.z-o.min.z)/2)),(a=o.translate(i.position.negate()).getCenter(new y)).lengthSq()&&(n.offset=a),n):null}function b(e){var t,r,n=function(e){var t=[];return e.traverse(function(e){"Mesh"===e.type&&t.push(e)}),t}(e),a=new c,o=new c;if(0===n.length)return null;if(1===n.length){var i=new y,m=new p,u=new y;return n[0].geometry.isBufferGeometry?n[0].geometry.attributes.position&&n[0].geometry.attributes.position.itemSize>2&&a.fromBufferGeometry(n[0].geometry):a=n[0].geometry.clone(),a.metadata=n[0].geometry.metadata,n[0].updateMatrixWorld(),n[0].matrixWorld.decompose(i,m,u),a.scale(u.x,u.y,u.z)}for(;r=n.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&&r.geometry.attributes.position.itemSize>2){var s=new c;s.fromBufferGeometry(r.geometry),o.merge(s,r.matrixWorld),s.dispose()}}else o.merge(r.geometry,r.matrixWorld);return(t=new d).scale(e.scale),o.applyMatrix(t),o}function S(e){return e.attributes||(e=(new g).fromGeometry(e)),(e.attributes.position||{}).array||[]}w.Type=x;export{w as threeToCannon};
//# sourceMappingURL=three-to-cannon.module.js.map
