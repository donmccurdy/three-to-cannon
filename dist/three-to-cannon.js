var e=require("cannon-es"),r=require("three/examples/jsm/math/ConvexHull.js"),t=require("three"),n=Math.PI/2,o={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},a=function(a,y){var l;if((y=y||{}).type===o.BOX)return m(a);if(y.type===o.CYLINDER)return function(r,o){var a,i,m,u=new t.Box3,s=["x","y","z"],y=o.cylinderAxis||"y",l=s.splice(s.indexOf(y),1)&&s;return u.setFromObject(r),isFinite(u.min.lengthSq())?(i=u.max[y]-u.min[y],m=.5*Math.max(u.max[l[0]]-u.min[l[0]],u.max[l[1]]-u.min[l[1]]),(a=new e.Cylinder(m,m,i,12))._type=e.Shape.types.CYLINDER,a.radiusTop=m,a.radiusBottom=m,a.height=i,a.numSegments=12,a.orientation=new e.Quaternion,a.orientation.setFromEuler("y"===y?n:0,"z"===y?n:0,0,"XYZ").normalize(),a):null}(a,y);if(y.type===o.SPHERE)return function(r,t){if(t.sphereRadius)return new e.Sphere(t.sphereRadius);var n=u(r);return n?(n.computeBoundingSphere(),new e.Sphere(n.boundingSphere.radius)):null}(a,y);if(y.type===o.HULL)return function(n){var o,a,i,m,s=u(n);if(!s||!s.vertices.length)return null;for(o=0;o<s.vertices.length;o++)s.vertices[o].x+=1e-4*(Math.random()-.5),s.vertices[o].y+=1e-4*(Math.random()-.5),s.vertices[o].z+=1e-4*(Math.random()-.5);for(m=(new r.ConvexHull).setFromObject(new t.Mesh(s)),a=new Array(m.vertices.length),o=0;o<m.vertices.length;o++)a[o]=new e.Vec3(m.vertices[o].x,m.vertices[o].y,m.vertices[o].z);for(i=new Array(m.faces.length),o=0;o<m.faces.length;o++)i[o]=[m.faces[o].a,m.faces[o].b,m.faces[o].c];return new e.ConvexPolyhedron(a,i)}(a);if(y.type===o.MESH)return(l=u(a))?function(r){var t,n=s(r);return n.length?(t=Object.keys(n).map(Number),new e.Trimesh(n,t)):null}(l):null;if(y.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',y.type);if(!(l=u(a)))return null;switch(l.metadata?l.metadata.type:l.type){case"BoxGeometry":case"BoxBufferGeometry":return i(l);case"CylinderGeometry":case"CylinderBufferGeometry":return function(r){var n,o=r.metadata?r.metadata.parameters:r.parameters;return(n=new e.Cylinder(o.radiusTop,o.radiusBottom,o.height,o.radialSegments))._type=e.Shape.types.CYLINDER,n.radiusTop=o.radiusTop,n.radiusBottom=o.radiusBottom,n.height=o.height,n.numSegments=o.radialSegments,n.orientation=new e.Quaternion,n.orientation.setFromEuler(t.Math.degToRad(90),0,0,"XYZ").normalize(),n}(l);case"PlaneGeometry":case"PlaneBufferGeometry":return function(r){r.computeBoundingBox();var t=r.boundingBox;return new e.Box(new e.Vec3((t.max.x-t.min.x)/2||.1,(t.max.y-t.min.y)/2||.1,(t.max.z-t.min.z)/2||.1))}(l);case"SphereGeometry":case"SphereBufferGeometry":return function(r){return new e.Sphere((r.metadata?r.metadata.parameters:r.parameters).radius)}(l);case"TubeGeometry":case"Geometry":case"BufferGeometry":return m(a);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',l.type),i(l)}};function i(r){if(!s(r).length)return null;r.computeBoundingBox();var t=r.boundingBox;return new e.Box(new e.Vec3((t.max.x-t.min.x)/2,(t.max.y-t.min.y)/2,(t.max.z-t.min.z)/2))}function m(r){var n,o,a=new t.Box3,i=r.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),a.setFromObject(i),isFinite(a.min.lengthSq())?(n=new e.Box(new e.Vec3((a.max.x-a.min.x)/2,(a.max.y-a.min.y)/2,(a.max.z-a.min.z)/2)),(o=a.translate(i.position.negate()).getCenter(new t.Vector3)).lengthSq()&&(n.offset=o),n):null}function u(e){var r,n,o=function(e){var r=[];return e.traverse(function(e){"Mesh"===e.type&&r.push(e)}),r}(e),a=new t.Geometry,i=new t.Geometry;if(0===o.length)return null;if(1===o.length){var m=new t.Vector3,u=new t.Quaternion,s=new t.Vector3;return o[0].geometry.isBufferGeometry?o[0].geometry.attributes.position&&o[0].geometry.attributes.position.itemSize>2&&a.fromBufferGeometry(o[0].geometry):a=o[0].geometry.clone(),a.metadata=o[0].geometry.metadata,o[0].updateMatrixWorld(),o[0].matrixWorld.decompose(m,u,s),a.scale(s.x,s.y,s.z)}for(;n=o.pop();)if(n.updateMatrixWorld(),n.geometry.isBufferGeometry){if(n.geometry.attributes.position&&n.geometry.attributes.position.itemSize>2){var y=new t.Geometry;y.fromBufferGeometry(n.geometry),i.merge(y,n.matrixWorld),y.dispose()}}else i.merge(n.geometry,n.matrixWorld);return(r=new t.Matrix4).scale(e.scale),i.applyMatrix(r),i}function s(e){return e.attributes||(e=(new t.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}a.Type=o,exports.threeToCannon=a;
//# sourceMappingURL=three-to-cannon.js.map
